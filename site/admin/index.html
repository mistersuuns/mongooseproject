<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Content Manager</title>
</head>
<body>
  <!-- Decap CMS admin - DecapBridge handles auth via PKCE as configured in config.yml -->
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  <script>
    (function () {
      var AUTO_KEY = 'decapbridge_cms_auto_login_done';

      function hasPkceStateInQuery() {
        try {
          return /[?&]state=/.test(window.location.search);
        } catch (e) {
          return false;
        }
      }

      function onLoginRoute() {
        var h = window.location.hash || '';
        h = h.toLowerCase();
        return h === '' || h === '#/' || h.indexOf('#/login') === 0;
      }

      function shouldAutoLogin() {
        if (typeof sessionStorage === 'undefined') return false;
        if (sessionStorage.getItem(AUTO_KEY) === '1') return false;
        if (!onLoginRoute()) return false;
        if (hasPkceStateInQuery()) return false; // don't interfere with PKCE callback
        return true;
      }

      function tryAutoLoginOnce() {
        if (!shouldAutoLogin()) return;

        var buttons = document.querySelectorAll('button');
        for (var i = 0; i < buttons.length; i++) {
          var btn = buttons[i];
          var text = (btn.textContent || '').trim().toLowerCase();
          if (text === 'login' || text === 'log in') {
            try {
              sessionStorage.setItem(AUTO_KEY, '1');
            } catch (e) {}
            btn.click();
            return;
          }
        }
      }

      window.addEventListener('load', function () {
        // Give Decap a moment to render the login UI, then try once.
        setTimeout(tryAutoLoginOnce, 800);
      });
    })();
  </script>
</body>
</html>

